<%- include('../partials/header') %>

<header class="d-flex justify-content-between">
    <div class="ms-5">
        <h1>Edit Product Details</h1>
    </div>
</header>

<div class="d-flex">
    <div class="product-images">
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleImageModal">Add image</button>
        <div class="modal fade" id="exampleImageModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Add Image</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form action="/sellers/addImage/<%=products._id%>" enctype="multipart/form-data"  method="post">
                      <input type="file" accept="image/*" name="image" required>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <button class="btn btn-primary" type="submit" >Add Image</button>
                        </div>
                  </form>
                </div>
                
              </div>
            </div>
          </div>
        <% if (products.images && products.images.length > 0) { %>
            <% for (let i = 0; i < products.images.length; i++) { %>
                <div class="ms-5 mt-2 mb-4 d-flex"><img data-bs-toggle="modal" data-bs-target="#exampleEditImageModal<%=i%>"  src="/sellers/getImage/<%=products._id%>/<%=i%>" width="100px" height="100px" alt="image">
                   <button  onclick="delImage('/sellers/deleteImage/<%=products._id%>/<%=i%>')" class="m-2 btn btn-hover btn-transparent"><i class="fa fa-trash fs-5 text-dark" aria-hidden="true"></i>
                   </a></div>
                <div class="modal fade" id="exampleEditImageModal<%=i%>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Add Image</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <form action="/sellers/editImage/<%=products._id%>/<%=i%>" enctype="multipart/form-data"  method="post">
                              <input type="file" accept="image/*" name="image" required>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                  <button class="btn btn-primary" type="submit" >Change Image</button>
                                </div>
                          </form>
                        </div>
                        
                      </div>
                    </div>
                  </div>
                  
                <% } %>
        <% } %>
    </div>
<main class="m-3">
    <section class="product-details">
        <div class="product-info">
            <form action="/sellers/edit/<%=products._id%>" method="post">
             <label><h2 class="m-3"><strong>Name:</strong></h2></label><input class="bg-transparent mt-4" type="text" value="<%=products.name%>" name="name">
            
          <br><label><h2 class="m-3 mt-0"><strong>Description:</strong></h2></label><textarea class="bg-transparent "  name="description"><%=products.description%></textarea><br>
          <label><h2 class="m-3"><strong>Price:</strong>&#8377;</h2></label><input class="bg-transparent mt-4" type="number" value="<%=products.price%>" name="price"><br>
          <label><h2 class="m-3"><strong>Discount:</strong></h2></label><input class="bg-transparent mt-4" type="number" value="<%=products.discount%>" name="discount"><br>
          <label><h2 class="m-3"><strong>Quantity:</strong></h2></label><input class="bg-transparent mt-4" value="<%=products.qty%>" name="qty">
          <br><label><h2 class="m-3"><strong>Stock:</strong></h2></label><input class="bg-transparent mt-4" type="number" min="1" value="<%=products.stock%>" name="stock">
          
          <br>  <button class="btn btn-success m-2" type="submit"> Save changes</button>
        </form>
        </div>
    </section>
</main>
<video id="product-video" controls autoplay muted data-bs-toggle="modal" data-bs-target="#exampleModal" height="400px" width="400px">
    <source src="/sellers/getVideo/<%=products._id%>" type="video/mp4">
    Your browser does not support the video tag.
</video>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Change Video</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/sellers/editVideo/<%=products._id%>" enctype="multipart/form-data"  method="post">
            <input type="file" accept="video/*" name="video" required>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="submit" >Change video</button>
              </div>
        </form>
      </div>
      
    </div>
  </div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  function delImage(url) {
  Swal.fire({
    title: '',
    text: 'Are you sure you want to delete this image?',
    icon: 'warning',
    buttons: ['Cancel', 'OK'],
    dangerMode: true,
  })
  .then((confirmed) => {
    if (confirmed) {
      fetch(url).then(res=>res.json()).then(res=>{window.location.href = res.data})
    } else {
      // User clicked "Cancel" or closed the dialog
      // You can handle this case as needed
    }
  });
};
      
// Get the <span> element that closes the modal
// var span = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
// span.onclick = function() {
//   modal.style.display = "none";
// }

</script>
<%- include('../partials/footer') %>