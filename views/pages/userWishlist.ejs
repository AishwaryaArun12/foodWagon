<%-include('../partials/header')%>
<link rel="stylesheet" href="../css/style.min.css">
	<!-- Menu Section -->

  <!-- Page content -->
  <div class="col-lg-12 pt-3 ms-3">
  <a href="/menu"><h4>More Products</h4></a>  
</div>
<div class="container-fluid mt-5 col-lg-12 d-flex flex-wrap" id="wishlist-container">
    <!-- Wishlist items will be dynamically added here -->
    <%if(wishlist.length == 0){%>
        <div class="p-2 m-4" style="position: absolute;"><h2>Your wishlist is empty!!!</h2></div>
        <%}%>
    <% wishlist.forEach(function(item,i) { %>
        <div class="card ms-4 mb-2 ">
            <a href="/users/product/<%=item._id%>">                       
                        <img src="/<%=item.images[0]%>" style="width:90%;height: 240px;">
                    <h3 class="text-dark text-truncate"><%=item.name%></h3>
                    
                    <pre><h3 class="price"><span class="text-danger text-decoration-line-through">&#8377;<%= Math.round(item.price*(100+item.discount)/100) %></span> &#8377;<span style="font-size: xx-large;"><%= item.price %></span><span class="text-dark">(<%=item.discount%></span><img class="pb-3" src="/img/icons/discounts.png" alt="" width="50px" height="50px">off)</h3></pre>
                </a><p><button class="btn1" onclick="addCart('<%=item._id%>')" >Add to Cart</button><button class="btn2"  onclick="addWish('<%=item._id%>','btn<%=i%>')"><i class="fa fa-heart text-danger " id="btn<%=i%>" aria-hidden="true"></i></button></p>
                  </div>
    <% }); %>
</div>
<script>
    const cart = document.getElementById('cart-counter');
        let cn = '<%=users.cart.length%>'
        cn = parseInt(cn);
        const wishlist = document.getElementById('wishlist-counter');
        let wn = '<%=users.wishlist.length%>'
                wn = parseInt(wn);
    function alerts(){
        window.location.href = '/users/cart'
    }
     async function addCart(id){
        //let updatedQ = document.getElementById('q').value;
    await fetch(`/users/addcart/${id}`).then(res=>res.json()).then(data=>{ 
        console.log(data);
        if(data.data=='Product added to cart successfully'){
            Swal.fire({    
            icon: 'success',
            title: 'Product added to cart successfully',    
            timer: 2000,
            })
            cart.innerHTML = cn+1;
            cn +=1;
        }else if(data.data == 'Already added this product to cart.'){
            Swal.fire({    
            icon: 'warning',
            title: 'Already added this product to cart.',    
            timer: 2000,
            })
        }else if(data.error){
            Swal.fire({
              icon: 'info',
              title: 'Sorry',
              text: 'Out of stock',
            })
        }
    })
  }     
     async function addWish(id,i){
                const btn = document.getElementById(i);
                
                    await fetch(`/users/removeWish/${id}`).then(res=>res.json()).then(res=>{
                    if(res.data == 'ok'){
                        wishlist.innerHTML = wn-1;
                    wn -=1;
                    window.location.href  = '/users/wishlist'
                    }
                   }).catch(error=>{console.log(error);}) 
        }
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<!-- External JS -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
	<script src="../../vendor/bootstrap/popper.min.js"></script>
	<script src="../../vendor/bootstrap/bootstrap.min.js"></script>
	<script src="../../vendor/select2/select2.min.js "></script>
	<script src="../../vendor/owlcarousel/owl.carousel.min.js"></script>
	<script src="https://cdn.rawgit.com/noelboss/featherlight/1.7.13/release/featherlight.min.js"></script>
	<script src="../../vendor/stellar/jquery.stellar.js" type="text/javascript" charset="utf-8"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>

	<!-- Main JS -->
 
	<script src="../../js/app.min.js "></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</body>
</html>
