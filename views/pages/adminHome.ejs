<%- include('../partials/header') %>
<div class="d-flex">
    <div class="sidebar">
        <ul class="nav-links">
            <li><a href="/admin/home"><b>Dashboard</b></a></li>
            <li><a href="/admin/allSeller">Sellers</a></li>
            <li><a href="/admin/allUser">Users</a></li>
            <li><a href="/admin/products">Products</a></li>
            <li><a href="/admin/orders">Orders</a></li>
            <!-- Add more menu items as needed -->
        </ul>
    </div>
    <div class="content">
    <%if(sellers.length !=0){%>
        <div class="container">
            <div>
                <h2>New Restuarents</h2>
            </div>
            <div>
                <table class="table table-striped table-hover table-warning">
                    <thead>
                      <tr>
                        <th scope="col">id</th>
                        <th scope="col">Seller Name</th>
                        <th scope="col">Location</th>
                        <th scope="col">Email</th>
                        <th scope="col">Approve</th>
                        <th scope="col">Reject</th>
                      </tr>
                    </thead>
                    <tbody>
                        <%for(let i=0;i<sellers.length;i++){%>
                            <tr>
                                <th scope="row"><%=sellers[i]._id%></th>
                                <td><%=sellers[i].name%></td>
                                <td><%=sellers[i].location%></td>
                                <td><%=sellers[i].email%></td>
                                <td>
                                    <button onclick="approve('<%=sellers[i].email%>')">
                                        <img  src="/img/icons/correct.png" alt="Approve" width="30px" height="30px">
                                    </button>
                                </td>
                                <td>
                                    <button type="button" onclick="addr('<%=sellers[i].email%>')" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                        <img  src="/img/icons/close.png" alt="Reject" width="30px" height="30px">
                                    </button>
                                </td>
      
                                <!-- Modal -->
                                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                       <div class="modal-content">
                                         <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">Reason for rejection</h1>
                                             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form onsubmit="event.preventDefault()">
                                                <div class="mb-3">
                                                    <label for="exampleFormControlTextarea1" class="form-label">Reason :</label>
                                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" placeholder="Type reason for rejection at here.."></textarea>
                                                </div>
                                            
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    <button type="submit" onclick="reject('<%=sellers[i].email%>')" class="btn btn-primary">Send</button>
                                                </div>
                                            </form>
                                    </div>
                                    </div>
                                    </div>
                                </div>  
                            </tr>
                            <%}%>
                          
                    </tbody>
                  </table>
            </div>
        </div>
        <%}%>
    </div>
</div>

    <script>
         async function approve(address){
            
          await fetch(`/admin/accept/sendMail/${address}`,{
            method : 'POST',
            headers : {
                'Content-Type' : 'application/json'
            }
          }).then(res=>res.text()).then(result=>{
            alert(result);
            window.location.reload();
        }).catch(error=>{
            console.error('Error in sending email : ',error);
            alert('Error sending Email');
          })  
        }
        let address = null;
        function addr(addr){
            address = addr;
        }
     function reject(){
            // console.log('in rect fn');
            const reason = document.getElementById('exampleFormControlTextarea1').value;
             fetch(`/admin/reject/sendMail/${address}/${reason}`,{
            method : 'POST',  
            headers : {
                'Content-Type' : 'application/json'
            } 
          }).then(res=>res.text()).then(result=>{
            alert(result)
            window.location.reload()
          }).catch(error=>{
            console.error(error);
            alert(error);
          });  
        }
    </script>
<%- include('../partials/footer') %>