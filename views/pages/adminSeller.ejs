<%- include('../partials/header') %>
<div class="d-flex">
  <div class="sidebar">
    <ul class="nav-links">
        <li><a href="/admin/home">Dashboard</a></li>
        <li><a href="/admin/allSeller"><b>Sellers</b></a></li>
        <li><a href="/admin/allUser">Users</a></li>
        <li><a href="/admin/allProducts">Products</a></li>
        <li><a href="/admin/orders">Orders</a></li>
        <li><a href="/admin/coupon">Coupon</a></li>
        <li><a href="/admin/category">Category</a></li>
        <!-- Add more menu items as needed -->
    </ul>
  </div>
   <div class="content">
    <%if(pendingSellers.length !=0){%>
      <div class="container">
          <div>
              <h2>New Sellers</h2>
          </div>
          <div>
              <table class="table table-striped table-hover table-warning">
                  <thead>
                    <tr>
                      <th scope="col">id</th>
                      <th scope="col">Seller Name</th>
                      <th scope="col">Location</th>
                      <th scope="col">Email</th>
                      <th scope="col">Approve</th>
                      <th scope="col">Reject</th>
                    </tr>
                  </thead>
                  <tbody>
                      <%for(let i=0;i<pendingSellers.length;i++){%>
                          <tr>
                              <th scope="row"><%=pendingSellers[i]._id%></th>
                              <td><%=pendingSellers[i].name%></td>
                              <td><%=pendingSellers[i].location%></td>
                              <td><%=pendingSellers[i].email%></td>
                              <td>
                                  <button onclick="approve('<%=pendingSellers[i].email%>')">
                                      <img  src="/img/icons/correct.png" alt="Approve" width="30px" height="30px">
                                  </button>
                              </td>
                              <td>
                                  <button type="button" onclick="addr('<%=pendingSellers[i].email%>')" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                      <img  src="/img/icons/close.png" alt="Reject" width="30px" height="30px">
                                  </button>
                              </td>
    
                              <!-- Modal -->
                              <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                  <div class="modal-dialog">
                                     <div class="modal-content">
                                       <div class="modal-header">
                                          <h1 class="modal-title fs-5" id="exampleModalLabel">Reason for rejection</h1>
                                           <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                      </div>
                                      <div class="modal-body">
                                          <form onsubmit="event.preventDefault()">
                                              <div class="mb-3">
                                                  <label for="exampleFormControlTextarea1" class="form-label">Reason :</label>
                                                  <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" placeholder="Type reason for rejection at here.."></textarea>
                                              </div>
                                          
                                              <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                  <button type="submit" onclick="reject('<%=pendingSellers[i].email%>')" class="btn btn-primary">Send</button>
                                              </div>
                                          </form>
                                  </div>
                                  </div>
                                  </div>
                              </div>  
                          </tr>
                          <%}%>
                        
                  </tbody>
                </table>
          </div>
      </div>
      <%}%>
    <div class="d-flex">
      <div>
        <h2 class="text-dark m-3 p-2">Sellers</h2>
     </div>
     <div class="container">
      <form class="d-flex" action="/admin/search/seller" method="post">
        <input class="form-control m-3 w-50  border border-danger" type="search" placeholder="Search user here.." aria-label="Search" name="q">

        <button class="btn btn-warning m-3" type="submit">Search</button>
      </form>
    </div>
    </div>
   <div class="m-4 p-2">
      <table class="table table-striped table-dark table-hover">
          <thead>
            <tr>
              <th scope="col">No.</th>
              <th scope="col">Name</th>
              <th scope="col">Email</th>
              <th scope="col">Menu</th>
              <th scope="col">Status</th>
              <th scope="col">Application status</th>
              <th scope="col">Location</th>
              <th scope="col">Delete</th>
            </tr>
          </thead>
          <tbody>
            <%for(let i = 0;i< (sellers ?? []).length;i++){%>
              <tr>
                  <th scope="row"><%= i+1 %></th>
                  <td><%= sellers[i].name %></td>
                  <td><%= sellers[i].email %></td>
                  <td><a href="/admin/menu/<%=sellers[i].menu%>"><%=sellers[i].name%>'s Menu</a> </td>
                  <td><% if(sellers[i].blocked == false){ %>
                      Active
                      <% }else{ %>
                          Blocked
                          <% } %></td>
                          <td><% if(sellers[i].status == 'approve'){ %>
                            Approve
                            <% }else if(sellers[i].status == 'pending'){ %>
                                Pending
                                <% }else{ %>
                                  Reject
                                  <%}%></td>
                  <td><%= sellers[i].location %></td>
                  
                  <td><% if(!sellers[i].blocked){ %>
                      <a href="/admin/block/seller/<%=sellers[i]._id%>" ><img src="/img/icons/delete.png" alt="" width="40px" height="40px"></a></td>
                      <% }else{ %>
                          <a href="/admin/unblock/seller/<%=sellers[i]._id%>"><img src="/img/icons/unblock.png" alt="" height="40px" width="40px"></a></td>
                          <% } %>
                </tr>
              <%}%>
          </tbody>
        </table>
   </div>
   </div>
</div>
<script>
  async function approve(address){
            
            await fetch(`/admin/accept/sendMail/${address}`,{
              method : 'POST',
              headers : {
                  'Content-Type' : 'application/json'
              }
            }).then(res=>res.text()).then(result=>{
              Swal.fire({    
            icon: 'success',
            title: result,    
            timer: 1000,
            
            })
              setTimeout(()=>{window.location.reload();},1000) 
          }).catch(error=>{
            Swal.fire({    
            icon: 'warning',
            title: 'Sorry, Error sending Email.',    
            timer: 1000,
            })
            setTimeout(()=>{window.location.reload();},1000)
            })  
          }
          let address = null;
          function addr(addr){
              address = addr;
          }
       function reject(){
              const reason = document.getElementById('exampleFormControlTextarea1').value;
               fetch(`/admin/reject/sendMail/${address}/${reason}`,{
              method : 'POST',  
              headers : {
                  'Content-Type' : 'application/json'
              } 
            }).then(res=>res.text()).then(result=>{
              Swal.fire({    
            icon: 'success',
            title: result,    
            timer: 1000,
            
            })
              setTimeout(()=>{window.location.reload();},1000)
            }).catch(error=>{
              Swal.fire({    
            icon: 'warning',
            title: 'Sorry, Error sending Email.',    
            timer: 1000,
            })
            setTimeout(()=>{window.location.reload();},1000)
            })  
            };  
</script>
<%- include('../partials/footer') %>