<%- include('../partials/header') %>

 <div >
  <div class="container d-flex w-100 ">
   
    <% if(error){ %>
      <div class="container w-100 border border-dark mb-3" id="error">
        <div class="text-center">
          <h3>
            <%=error%>
          </h3>
        </div>
        <div class="text-center">
          <button class="btn btn-primary mb-2" onclick="errorBtn('<%=user %>')">Ok</button>
        </div>
      </div>
      <%}%>
      
        <!-- Modal -->
        <div class="modal  fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
          aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Create new item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              
              <div >
                <div class="modal-body">
                  <div>
                    <form class="row g-3 m-3" enctype="multipart/form-data" onsubmit="(e)=>e.preventDefault()"
                      method="post" action="../sellers/addVideo">
                      <div class="col-lg-6">
                        <input type="file" class="form-control" id="video" name="video" multiple accept="video/*" required>
                      </div>
                      <div class="col-lg-4">
                        <button type="submit">Add Video</button>
                      </div>
                    </form>
                  </div>
  
                  <form class="row g-3 m-3" enctype="multipart/form-data" onsubmit="(e)=>e.preventDefault()" method="post"
                    action="../sellers/addItem">
                    <div class="row">
                      <div class="col-md-6">
                        <label for="foodType" class="form-label">Food Type</label>
                        <select id="inputFoodType" name="foodType" class="form-select" required onchange="change(this.value)">
                          <option selected disabled>Choose...</option>
                          <% for(let i=0;i<foodType.length;i++){ %>
                            <option  value='<%=foodType[i]%>'>
                              <%= foodType[i] %>
                            </option>
                            <% } %>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label for="category" class="form-label">Category</label>
                        <select id="category" name="category" class="form-select" required></select>
                  
                      </div>
                      <div class="col-12">
                        <label for="itemName" class="form-label">Item name</label>
                        <input type="text" class="form-control" id="itemName" placeholder="Item name..." name="itemName"
                          required>
                      </div>
                      <div class="col-12">
                        <label for="images" class="form-label">Item Images</label>
                        <input type="file" class="form-control" id="images" name="images" multiple accept="image/*"
                          required>
                      </div>
                      <div class="col-12">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" required></textarea>
                      </div>
              
              <div class="col-md-4">
                <label for="discount" class="form-label">Discount</label>
                <input type="number" class="form-control" id="discount" name="discount" placeholder="Discount" required>
              </div>
              <div class="col-md-4">
                <label for="qty" class="form-label">Quantity</label>
                <input type="text" class="form-control" id="qty" name="qty" placeholder="Quantity" required>
              </div>
              
              <div class="col-md-4">
                <label for="price" class="form-label">Price</label>
                <input type="number" class="form-control" id="price" name="price" placeholder="Price" required>
              </div>
              <div class="col-6">
                <label for="stock" class="form-label">Stock</label>
                <input type="number" class="form-control" id="stock" name="stock" placeholder="Stock" required>
              </div>
             </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Add item</button>
          </div>
              </form>
          </div>
              </div>
      </div>
    </div>
    </div>

    <div class="container-fluid row mb-2 mt-2">
      <div class="col-7"></div>
      <form class="d-flex col-5" action="../sellers/search">
        <input class="form-control border border-danger w-50" type="search" placeholder="Search Items.." aria-label="Search" name="q">

        <button class="btn btn-danger " type="submit">Search</button>
      </form>
      <a  class="col-2 fs-3 me-4 mt-1 text-dark text-nowrap" data-bs-toggle="modal"
      data-bs-target="#staticBackdrop"><i class="fa fa-plus fs-2" aria-hidden="true"></i>

      <span class="text-danger">A</span>dd New Item
    </a>
    </div>
  </div>
 </div>
 
<div id="search">
  <% if(search != ''){ %>
    <table class="table table-dark table-hover align-middle table-striped">
      <thead>
        <tr>
          <th scope="col">Item Name</th>
          <th scope="col">Images</th>
          <th scope="col">Discount</th>
          
          <th scope="col">Price</th>
          <th scope="col">Stock</th>
          <th scope="col">Status</th>
          <th scope="col">Edit</th>
          <th scope="col">Delete</th>
          <th><a href="/sellers/search/close" ><img src="/img/icons/close.png" width="40px" height="40px" alt="close"></a></th>
        </tr>
      </thead>
      <tbody><% search.forEach(item => { %>
        <tr>
          
          <td><%= item.name %></td>
          <td><img src="<%=item.images[0]%>" width="100px" height="100px" alt="image"></td>
          <td><%= item.discount %></td>
          <td><%= item.price %></td>
          <td><%= item.stock %></td>
          <td><% if(item.blocked == false){ %>
            Active
            <% }else{ %>
                Blocked
                <% } %></td>
          <td><a href=""><i class="fa fa-pencil-square-o fs-4" aria-hidden="true"></i></a></td>
          <td><% if(item.blocked == false){ %>
              <a href="" ><i class="fa fa-trash" aria-hidden="true"></td>
              <% }else{ %>
                  <a href=""><img src="/img/icons/unblock.png" alt="" height="40px" width="40px"></a></td>
                  <% } %>
        </tr>
      <% }); %>
    </tbody>
  </table>
    <% } %>
</div>

  <div class="container-fluid" id="menu">
    <% menus.menu.forEach(menuItem => { %>
      <%if(menuItem.category.length != 0){%>
        <h2><%= menuItem.name %></h2>
        <% menuItem.category.forEach(category => { %>
          
          <div class="d-flex">
            <h3><%= category.name %></h3>
            <h3 class="ms-auto "><% if(category.blocked == false){ %>
              Active
              <% }else{ %>
                  Blocked
                  <% } %></h3>
            <% if(category.blocked == false){ %>
              <a href="/sellers/block/<%=category.name%>/<%=menus._id%>" class="ms-auto p-2"><img src="/img/icons/delete.png" alt="" width="30px" height="30px"></a></td>
              <% }else{ %>
                  <a href="/sellers/unblock/<%=category.name%>/<%=menus._id%>"><img src="/img/icons/unblock.png" alt="" height="40px" width="40px"></a></td>
                  <% } %>
          </div>
          <table class="table table-dark table-hover align-middle table-striped overflow-y: hidden">
            <thead>
              <tr>
                <th scope="col">Item Name</th>
                <th scope="col">Images</th>
                <th scope="col">Video</th>
                <th scope="col">Discount</th>
                <th scope="col">Quantity</th>
                <th scope="col">Price</th>
                <th scope="col">Stock</th>
                <th scope="col">Status</th>
                <th scope="col">Edit</th>
                <th scope="col">Delete</th>
              </tr>
            </thead>
            <tbody>
              <% category.items.forEach(item => { %>
                <%if(item.item){%>
                  <tr>  
                      <td>
                        <a href="/sellers/product/<%=item.item._id%>">
                        <%= item.item.name %>
                        </a>
                    </td>   

                    <td>
                      
                      <img class="myImg m-3" src="/<%=item.item.images[0]%>" width="100px" height="100px" alt="image">
                     
                    </td>
                      <div id="myModal" class="modal">

                        <!-- The Close Button -->
                        <span class="close">&times;</span>
                      
                        <!-- Modal Content (The Image) -->
                        <img class="modal-content" id="img01">
                      
                        <!-- Modal Caption (Image Text) -->
                        <div id="caption"></div>
                      </div>
                      <td><video controls width="200" height="200">
                        <source src="<%=item.item.video%>" type="video/mp4">
                        Your browser does not support the video tag.
                    </video></td>
                    <td><%= item.item.discount %>%</td>
                    <td><%= item.item.qty %></td>
                   
                    <td>&#8377;<%= item.item.price %></td>
                    <td><%= item.item.stock %></td>
                    <td><% if(item.item.blocked == false){ %>
                      Active
                      <% }else{ %>
                          Blocked
                          <% } %></td>
                    <td><a href="/sellers/editItem/<%=item.item._id%>"><i class="fa fa-pencil-square-o fs-3 text-light" aria-hidden="true"></i></a></td>
                    <td><% if(item.item.blocked == false){ %>
                        <a href="/sellers/block/item/<%=item.item._id%>" ><i class="fa fa-trash fs-3 text-light" aria-hidden="true"></a></td>
                        <% }else{ %>
                            <a href="/sellers/unblock/item/<%=item.item._id%>"><img src="/img/icons/unblock.png" alt="" height="40px" width="40px"></a></td>
                            <% } %>
                  </tr>
                  <%}%>
              <% }); %>
            </tbody>
          </table>
        <% }); %>
        <%}%>
    <% }); %>
  </div>
  </div>
  
  <script>
       var categories = JSON.parse('<%- JSON.stringify(category) %>');
       var foodType =  JSON.parse('<%- JSON.stringify(foodType) %>');
function change(j){
  
  let i = foodType.indexOf(j);
  const categorySelect = document.getElementById("category");
  // Clear existing category options
  categorySelect.innerHTML = "";
  
   let category = categories[i];
    //categories = categories[i];
    
  // Create and append new category options based on the selected food type
  populateSelect(categorySelect, category);
  
}

function populateSelect(selectElement, optionsArray) {
  optionsArray.forEach((option) => {
    const optionElement = document.createElement("option");
    optionElement.value = option;
    optionElement.textContent = option;
    selectElement.appendChild(optionElement);
  });

}

    function errorBtn(user){
          const div = document.getElementById('error');
          div.style.display = 'none';
          window.location.href = `/${user}`;
        }
    var modal = document.getElementById("myModal");
    // Get the image and insert it inside the modal - use its "alt" text as a caption
    var imgs = document.getElementsByClassName("myImg");
    var modalImg = document.getElementById("img01");
    var captionText = document.getElementById("caption");
    for (let i = 0; i < imgs.length; i++) {
      imgs[i].onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
        captionText.innerHTML = this.alt;
      }
    }
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      modal.style.display = "none";
    }
  </script> 
  
  <script src="../script.js" ></script> 

<%- include('../partials/footer') %>